{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "NamingConvention": {
      "type": "string",
      "defaultValue": "khl",
      "metadata": {
        "description": "VNet1 Name"
      }
    },
    "SubDNSBaseDN": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
          "description": "Sub DNS Domain Name Example:  DC=sub2,DC=sub1, must include COMMA AT END"
      }
    },            
    "NetBiosDomain": {
      "type": "string",
      "defaultValue": "killerhomelab",
      "metadata": {
          "description": "NetBios Parent Domain Name"
      }
    },  
    "InternalDomain": {
      "type": "string",
      "defaultValue": "killerhomelab",
      "metadata": {
          "description": "NetBios Domain Name"
      }
    },       
    "TLD": {
      "type": "string",
      "defaultValue": "com",
      "allowedValues": [
        "com",
        "net",
        "org",
        "edu",
        "gov",
        "mil"
      ],      
      "metadata": {
          "description": "Top-Level Domain Name"
      }
    },                              
    "_artifactsLocation": {
      "type": "string",
      "metadata": {
          "description": "The location of resources, such as templates and DSC modules, that the template depends on"
      },
      "defaultValue": "[deployment().properties.templateLink.uri]"
    },
    "_artifactsLocationSasToken": {
        "type": "securestring",
        "metadata": {
            "description": "Auto-generated token to access _artifactsLocation. Leave it blank unless you need to provide your own value."
        },
        "defaultValue": ""
    }
  },
  "variables": {
    "dc1name": "[concat(parameters('NamingConvention'),'-dc-01')]",           
    "BaseDN": "[concat(parameters('SubDNSBaseDN'),'DC=',parameters('InternalDomain'),',DC=',parameters('TLD'))]",
    "WKOUPath": "[concat('OU=Workstations,',variables('BaseDN'))]",
    "WK10OUPath": "[concat('OU=Windows 10,OU=Workstations,',variables('BaseDN'))]",    
    "SVROUPath": "[concat('OU=Servers,',variables('BaseDN'))]",    
    "SVR2016OUPath": "[concat('OU=Servers2016,OU=Servers,',variables('BaseDN'))]",        
    "DefaultDomainGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/Default Domain Policy.zip",
    "DefaultDomainGPOGUID": "079C9640-8D6E-40F1-8618-1A026A2E5D76",
    "DefaultDomainGPOName": "Default Domain Policy",
    "IEEnhancedGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/IE11_Enhanced Testing.zip",
    "IEEnhancedGPOGUID": "871799F3-F246-4CA9-ABF8-BD78D9E0559B ",
    "IEEnhancedGPOName":  "IE11_Enhanced Testing",
    "PolicyDefinitionsURL":  "https://elliottf.blob.core.windows.net/github/GPOs/PolicyDefinitions.zip",
    "PolicyDefinitionsName":  "PolicyDefinitions",
    "SVR2016BaselineGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/SVR-2016-Baseline-v3.zip",
    "SVR2016BaselineGPOGUID":  "27764575-1F9E-4962-A039-EC6B650BEF43",
    "SVR2016BaselineGPOName":  "SVR-2016-Baseline-v3",
    "SVR2016DCBaselineGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/SVR-2016-DC-Baseline-v2.zip",
    "SVR2016DCBaselineGPOGUID": "DB77366E-8E1F-4D88-8041-AA10201E9704",
    "SVR2016DCBaselineGPOName": "SVR-2016-DC-Baseline-v2",
    "SVRBaselineGPOURL": "https://elliottf.blob.core.windows.net/github/GPOs/SVR-Baseline-v3.zip",
    "SVRBaselineGPOGUID": "F733FEB4-3992-4D28-8A7A-C8210F72A778",
    "SVRBaselineGPOName": "SVR-Baseline-v3",
    "SVRDCBaselineGPOURL": "https://elliottf.blob.core.windows.net/github/GPOs/SVR-DC-Baseline-v3.zip",
    "SVRDCBaselineGPOGUID": "2109B8C1-6A7F-4CEB-8C42-E0D985E4AFA1",
    "SVRDCBaselineGPOName": "SVR-DC-Baseline-v3",
    "SVRDCBaselineTimeGPOURL": "https://elliottf.blob.core.windows.net/github/GPOs/SVR-DC-Baseline-WindowsTimeSource-v1.zip",
    "SVRDCBaselineTimeGPOGUID": "20B6E319-1ED7-41FE-BABD-3D9C8A1EB9CE",
    "SVRDCBaselineTimeGPOName": "SVR-DC-Baseline-WindowsTimeSource-v1",
    "SVRDisableSSLGPOURL": "https://elliottf.blob.core.windows.net/github/GPOs/SVR-Disable-SSL-TLS(Except-TLS-1.2)-TEST.zip",
    "SVRDisableSSLGPOGUID": "9BE6002A-4B9F-4FB6-8CB6-DAA6BEF87AAD",
    "SVRDisableSSLGPOName": "SVR-Disable-SSL-TLS(Except-TLS-1.2)-TEST",
    "WKSBaselineGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/WKS-Baseline-v3.zip",
    "WKSBaselineGPOGUID":  "B0FB8233-96D9-47FA-B653-F54B83452468",
    "WKSBaselineGPOName":  "WKS-Baseline-v3",
    "WKSDisableSSLGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/WKS-Disable-SSL-TLS(Except-TLS-1.2)-TEST.zip",
    "WKSDisableSSLGPOGUID":  "2E69AEBB-52CC-4A92-8445-35E39E105BED",
    "WKSDisableSSLGPOName":  "WKS-Disable-SSL-TLS(Except-TLS-1.2)-TEST",
    "WKSWIN10BaselineGPOURL":  "https://elliottf.blob.core.windows.net/github/GPOs/WKS-WIN10-Baseline-v3.zip",
    "WKSWIN10BaselineGPOGUID": "6DDB9814-EC43-4E25-8178-4F306520C840",
    "WKSWIN10BaselineGPOName": "WKS-WIN10-Baseline-v3"
  },  
  "resources": [
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2019-10-01",
      "name": "ApplySTIGS",
      "properties": {
          "mode": "Incremental",
          "templateLink": {
              "uri": "[uri(parameters('_artifactsLocation'), concat('nestedtemplates/applystigs.json', parameters('_artifactsLocationSasToken')))]",
              "contentVersion": "1.0.0.0"
          },
          "parameters": {
              "computerName": {
                  "value": "[variables('dc1name')]"
              },
              "NetBiosDomain": {
                  "value": "[parameters('NetBiosDomain')]"
              },              
              "BaseDN": {
                  "value": "[variables('BaseDN')]"
              },                            
              "SVROUPath": {
                  "value": "[variables('SVROUPath')]"
              },
              "SVR2016OUPath": {
                  "value": "[variables('SVR2016OUPath')]"
              },                                          
              "WKOUPath": {
                  "value": "[variables('WKOUPath')]"
              },
              "WK10OUPath": {
                  "value": "[variables('WK10OUPath')]"
              },              
              "DefaultDomainGPOURL": {
                  "value": "[variables('DefaultDomainGPOURL')]"
              },                            
              "SVRDCBaselineGPOURL": {
                  "value": "[variables('SVRDCBaselineGPOURL')]"
              },                            
              "SVR2016DCBaselineGPOURL": {
                  "value": "[variables('SVR2016DCBaselineGPOURL')]"
              },                            
              "SVRDCBaselineTimeGPOURL": {
                  "value": "[variables('SVRDCBaselineTimeGPOURL')]"
              },                            
              "SVRBaselineGPOURL": {
                  "value": "[variables('SVRBaselineGPOURL')]"
              },                            
              "SVR2016BaselineGPOURL": {
                  "value": "[variables('SVR2016BaselineGPOURL')]"
              },                            
              "SVRDisableSSLGPOURL": {
                  "value": "[variables('SVRDisableSSLGPOURL')]"
              },                            
              "WKSBaselineGPOURL": {
                  "value": "[variables('WKSBaselineGPOURL')]"
              },                            
              "WKSWIN10BaselineGPOURL": {
                  "value": "[variables('WKSWIN10BaselineGPOURL')]"
              },                            
              "WKSDisableSSLGPOURL": {
                  "value": "[variables('WKSDisableSSLGPOURL')]"
              },                                                                                                                                                          
              "IEEnhancedGPOURL": {
                  "value": "[variables('IEEnhancedGPOURL')]"
              },
              "PolicyDefinitionsURL": {
                  "value": "[variables('PolicyDefinitionsURL')]"
              },
              "DefaultDomainGPOGUID": {
                  "value": "[variables('DefaultDomainGPOGUID')]"
              },
              "SVRDCBaselineGPOGUID": {
                  "value": "[variables('SVRDCBaselineGPOGUID')]"
              },
              "SVR2016DCBaselineGPOGUID": {
                  "value": "[variables('SVR2016DCBaselineGPOGUID')]"
              },
              "SVRDCBaselineTimeGPOGUID": {
                  "value": "[variables('SVRDCBaselineTimeGPOGUID')]"
              },
              "SVRBaselineGPOGUID": {
                  "value": "[variables('SVRBaselineGPOGUID')]"
              },
              "SVR2016BaselineGPOGUID": {
                  "value": "[variables('SVR2016BaselineGPOGUID')]"
              },
              "SVRDisableSSLGPOGUID": {
                  "value": "[variables('SVRDisableSSLGPOGUID')]"
              },
              "WKSBaselineGPOGUID": {
                  "value": "[variables('WKSBaselineGPOGUID')]"
              },    
              "WKSWIN10BaselineGPOGUID": {
                  "value": "[variables('WKSWIN10BaselineGPOGUID')]"
              },  
              "WKSDisableSSLGPOGUID": {
                  "value": "[variables('WKSDisableSSLGPOGUID')]"
              },  
              "IEEnhancedGPOGUID": {
                  "value": "[variables('IEEnhancedGPOGUID')]"
              },  
              "DefaultDomainGPOName": {
                  "value": "[variables('DefaultDomainGPOName')]"
              },  
              "SVRDCBaselineGPOName": {
                  "value": "[variables('SVRDCBaselineGPOName')]"
              },  
              "SVR2016DCBaselineGPOName": {
                  "value": "[variables('SVR2016DCBaselineGPOName')]"
              },  
              "SVRDCBaselineTimeGPOName": {
                  "value": "[variables('SVRDCBaselineTimeGPOName')]"
              },  
              "SVRBaselineGPOName": {
                  "value": "[variables('SVRBaselineGPOName')]"
              },  
              "SVR2016BaselineGPOName": {
                  "value": "[variables('SVR2016BaselineGPOName')]"
              },  
              "SVRDisableSSLGPOName": {
                  "value": "[variables('SVRDisableSSLGPOName')]"
              },  
              "WKSBaselineGPOName": {
                  "value": "[variables('WKSBaselineGPOName')]"
              },                                                                                                                                                                                                                                                                                                   
              "WKSWIN10BaselineGPOName": {
                  "value": "[variables('WKSWIN10BaselineGPOName')]"
              }, 
              "WKSDisableSSLGPOName": {
                  "value": "[variables('WKSDisableSSLGPOName')]"
              }, 
              "IEEnhancedGPOName": {
                  "value": "[variables('IEEnhancedGPOName')]"
              },                             
              "PolicyDefinitionsName": {
                  "value": "[variables('PolicyDefinitionsName')]"
              },               
              "location": {
                  "value": "[resourceGroup().location]"
              }
          }
      }
    }
  ]
}
